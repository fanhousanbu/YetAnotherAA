(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2555:function(e,t,s){Promise.resolve().then(s.bind(s,4068))},4068:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return HomePage}});var a=s(7437),r=s(2265),l=s(9439);async function isPasskeyAvailable(){return!!window.PublicKeyCredential&&await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()}async function verifyPasskeyCredential(e){return await (0,l.oz)({optionsJSON:e})}let n="http://localhost:3001";let ApiError=class ApiError extends Error{constructor(e,t){super(t),this.status=e,this.name="ApiError"}};async function apiRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="".concat(n).concat(e),a=await fetch(s,{headers:{"Content-Type":"application/json",...t.headers},...t}),r=await a.json();if(!a.ok)throw new ApiError(a.status,r.message||"API request failed: ".concat(a.status," ").concat(a.statusText));return r}let i={auth:{checkEmailExists:async e=>apiRequest("/auth/email/check/".concat(encodeURIComponent(e)),{method:"GET"}),getUserByEmail:async e=>apiRequest("/auth/user/email/".concat(encodeURIComponent(e)),{method:"GET"}),registerStart:async e=>apiRequest("/auth/register/start",{method:"POST",body:JSON.stringify({email:e})}),registerComplete:async e=>apiRequest("/auth/register/complete",{method:"POST",body:JSON.stringify(e)}),loginStart:async e=>apiRequest("/auth/login/start",{method:"POST",body:JSON.stringify({email:e})}),loginComplete:async e=>apiRequest("/auth/login/complete",{method:"POST",body:JSON.stringify(e)})},transfer:{createTransfer:async e=>{let t={to:e.toAddress,value:e.amount,data:"0x",operation:0};return apiRequest("/api/userop",{method:"POST",body:JSON.stringify({accountAddress:e.accountAddress,txRequest:t,paymasterEnabled:!1})})},sendTransfer:async e=>apiRequest("/api/userop/send",{method:"POST",body:JSON.stringify(e)}),estimateTransferGas:async e=>{let t={to:e.toAddress,value:e.amount,data:"0x",operation:0};return apiRequest("/api/userop/estimate",{method:"POST",body:JSON.stringify({accountAddress:e.accountAddress,txRequest:t,paymasterEnabled:!1})})},createAndSendSignedTransfer:async e=>{try{let t=await fetch("".concat(n,"/userop/signed"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountAddress:e.accountAddress,txRequest:{to:e.to,value:e.value,data:e.data||"0x",operation:0},paymasterEnabled:e.paymasterEnabled||!1,passkeyVerification:e.passkeyVerification,requiredNodeCount:e.requiredNodeCount||3})});if(!t.ok){let e=await t.json();throw Error(e.message||"Transfer failed")}let s=await t.json();return console.log("带BLS签名的转账成功:",s),s}catch(e){throw console.error("带BLS签名的转账失败:",e),e}},prepareSignedTransfer:async e=>{try{let t=await fetch("".concat(n,"/userop/prepare"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountAddress:e.accountAddress,txRequest:{to:e.to,value:e.value,data:e.data||"0x",operation:0},paymasterEnabled:e.paymasterEnabled||!1,passkeyVerification:e.passkeyVerification,requiredNodeCount:e.requiredNodeCount||3})});if(!t.ok){let e=await t.json();throw Error(e.message||"Prepare transfer failed")}let s=await t.json();return console.log("转账准备完成:",s),s}catch(e){throw console.error("转账准备失败:",e),e}}}};var c=s(774),o=s(1295);function LoginForm(e){let{onLogin:t,onSwitchToRegister:s}=e,[l,n]=(0,r.useState)(""),[d,m]=(0,r.useState)(!1),[x,u]=(0,r.useState)(""),[h,g]=(0,r.useState)(!1),handlePasskeyLogin=async()=>{m(!0),u("");try{let{options:e}=await i.auth.loginStart(""),s=await verifyPasskeyCredential(e),{user:a}=await i.auth.loginComplete({credentialId:s.id,response:s,challenge:e.challenge}),r={id:a.credentialId,email:a.email,name:a.email.split("@")[0],walletAddress:a.aaAddress,hasPasskey:!0,createdAt:a.createdAt};t(r)}catch(e){console.error("登录失败:",e),e instanceof ApiError?404===e.status?u("未找到 Passkey，请先注册或使用邮箱恢复账号"):401===e.status?u("Passkey 验证失败，请重试"):u(e.message):u("登录失败，请重试")}finally{m(!1)}},handleEmailRecovery=async e=>{if(e.preventDefault(),!l){u("请输入邮箱地址");return}m(!0),u("");try{u("邮箱恢复功能尚未实现")}catch(e){console.error("恢复失败:",e),u("账号恢复失败，请重试")}finally{m(!1)}};return(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-center mb-6",children:"登录"}),x&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:x}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("button",{onClick:handlePasskeyLogin,disabled:d,className:"btn-primary w-full flex items-center justify-center py-4 text-lg",children:d?(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Z,{className:"h-6 w-6 mr-3"}),"使用 Passkey 登录"]})}),(0,a.jsx)("p",{className:"text-sm text-gray-500 text-center mt-2",children:"点击按钮，使用您的指纹、面容或设备密码登录"})]}),(0,a.jsxs)("div",{className:"relative mb-6",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,a.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,a.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,a.jsx)("span",{className:"px-2 bg-white text-gray-500",children:"遇到问题？"})})]}),h?(0,a.jsxs)("form",{onSubmit:handleEmailRecovery,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"注册时使用的邮箱地址"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(o.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,a.jsx)("input",{type:"email",id:"email",name:"email",value:l,onChange:e=>{n(e.target.value),u("")},className:"input-field pl-10",placeholder:"请输入邮箱地址",required:!0})]})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{g(!1),n(""),u("")},className:"btn-secondary flex-1",children:"取消"}),(0,a.jsx)("button",{type:"submit",disabled:d,className:"btn-primary flex-1 flex items-center justify-center",children:d?(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):"发送恢复链接"})]})]}):(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("button",{onClick:()=>g(!0),className:"text-primary-600 hover:text-primary-700 text-sm font-medium",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 mr-1 inline"}),"通过邮箱恢复账号"]}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"适用于更换设备或无法使用 Passkey 的情况"})]}),(0,a.jsx)("div",{className:"mt-8 text-center",children:(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["还没有账号？"," ",(0,a.jsx)("button",{onClick:s,className:"text-primary-600 hover:text-primary-700 font-medium",children:"立即注册"})]})})]})}function RegisterForm(e){let{onRegister:t,onSwitchToLogin:s}=e,[n,c]=(0,r.useState)(""),[o,d]=(0,r.useState)(!1),[m,x]=(0,r.useState)(""),[u,h]=(0,r.useState)(!1),handleRegister=async e=>{e.preventDefault(),d(!0),x(""),h(!1);try{let e;console.log("Starting registration for email:",n);let{options:a}=await i.auth.registerStart(n);console.log("Registration options received:",a);try{console.log("Starting WebAuthn registration...");let t={...a,challenge:a.challenge,user:{...a.user,id:a.user.id},excludeCredentials:a.excludeCredentials||[]};console.log("Processed registration options:",t),e=await (0,l.RQ)({optionsJSON:t}),console.log("WebAuthn registration successful:",e)}catch(e){var s;if(console.error("WebAuthn registration error:",e),console.error("Error name:",null==e?void 0:e.name),console.error("Error message:",null==e?void 0:e.message),console.error("Error stack:",null==e?void 0:e.stack),(null==e?void 0:e.name)==="NotAllowedError")throw Error("用户取消了 Passkey 创建或操作超时");if((null==e?void 0:e.name)==="InvalidStateError")throw Error("该邮箱已经注册过 Passkey，请尝试登录");if((null==e?void 0:e.name)==="NotSupportedError")throw Error("您的设备或浏览器不支持 Passkey 功能");if((null==e?void 0:e.name)==="SecurityError")throw Error("安全错误：请确保在安全的 HTTPS 环境下使用");else if(null==e?void 0:null===(s=e.message)||void 0===s?void 0:s.includes("RESULT_CODE_KILLED_BAD_MESSAGE"))throw Error("Passkey 创建失败：数据格式错误，请重试");else throw Error("创建 Passkey 失败: ".concat((null==e?void 0:e.message)||"未知错误"))}console.log("Completing registration...");let{user:r}=await i.auth.registerComplete({email:n,response:e,challenge:a.challenge});if(h(!0),console.log("Registration successful:",r),t){let e={id:r.credentialId,email:r.email,name:n.split("@")[0],walletAddress:r.aaAddress,hasPasskey:!0,createdAt:new Date().toISOString()};t(e)}}catch(e){console.error("Registration error:",e),x(e instanceof Error?e.message:"注册失败，请重试")}finally{d(!1)}};return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"注册账户"}),(0,a.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:"使用 Passkey 注册新账户"})]}),m&&(0,a.jsx)("div",{className:"rounded-md bg-red-50 p-4",children:(0,a.jsx)("div",{className:"flex",children:(0,a.jsx)("div",{className:"ml-3",children:(0,a.jsx)("h3",{className:"text-sm font-medium text-red-800",children:m})})})}),u&&(0,a.jsx)("div",{className:"rounded-md bg-green-50 p-4",children:(0,a.jsx)("div",{className:"flex",children:(0,a.jsx)("div",{className:"ml-3",children:(0,a.jsx)("h3",{className:"text-sm font-medium text-green-800",children:"注册成功！"})})})}),(0,a.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:handleRegister,children:[(0,a.jsx)("div",{className:"rounded-md shadow-sm -space-y-px",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"sr-only",children:"邮箱地址"}),(0,a.jsx)("input",{id:"email",name:"email",type:"email",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"邮箱地址",value:n,onChange:e=>c(e.target.value),disabled:o})]})}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{type:"submit",disabled:o,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white ".concat(o?"bg-indigo-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"),children:o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"注册中..."]}):"使用 Passkey 注册"})}),s&&(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("button",{type:"button",onClick:s,className:"text-sm text-indigo-600 hover:text-indigo-500",children:"已有账号？点击登录"})})]})]})})}function storage_generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}function formatDate(e){return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function formatAddress(e){return e?"".concat(e.slice(0,6),"...").concat(e.slice(-4)):""}let d={saveContact(e){let t=this.getContacts();t.push(e),localStorage.setItem("contacts",JSON.stringify(t))},getContacts(){let e=localStorage.getItem("contacts");return e?JSON.parse(e):[]},getUserContacts(e){let t=this.getContacts();return t.filter(t=>t.userId===e)},getContactByAddress(e){let t=this.getContacts();return t.find(t=>t.walletAddress&&t.walletAddress.toLowerCase()===e.toLowerCase())||null},getContactByEmail(e){let t=this.getContacts();return t.find(t=>t.email&&t.email.toLowerCase()===e.toLowerCase())||null},isContactExists(e,t,s){let a=this.getUserContacts(e);return t?a.some(e=>e.walletAddress&&e.walletAddress.toLowerCase()===t.toLowerCase()):!!s&&a.some(e=>e.email&&e.email.toLowerCase()===s.toLowerCase())},updateContact(e){let t=this.getContacts(),s=t.findIndex(t=>t.id===e.id);-1!==s&&(t[s]=e,localStorage.setItem("contacts",JSON.stringify(t)))},deleteContact(e){let t=this.getContacts(),s=t.filter(t=>t.id!==e);localStorage.setItem("contacts",JSON.stringify(s))}},m={saveTransfer(e){let t=this.getTransfers();t.push(e),localStorage.setItem("transfers",JSON.stringify(t))},getTransfers(){let e=localStorage.getItem("transfers");return e?JSON.parse(e):[]},getUserTransfers(e){let t=this.getTransfers();return t.filter(t=>t.fromAddress.toLowerCase()===e.toLowerCase()||t.toAddress.toLowerCase()===e.toLowerCase())},updateTransfer(e){let t=this.getTransfers(),s=t.findIndex(t=>t.id===e.id);-1!==s&&(t[s]=e,localStorage.setItem("transfers",JSON.stringify(t)))}},formatCurrency=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CNY";return new Intl.NumberFormat("zh-CN",{style:"currency",currency:t}).format(e)};var x=s(4822),u=s(4527),h=s(6020),g=s(5367);function ContactList(e){let{contacts:t,onDelete:s,onTransfer:r}=e,handleDeleteContact=e=>{confirm("确定要删除这个联系人吗？")&&s(e)},getContactDisplayInfo=e=>e.walletAddress?{icon:(0,a.jsx)(x.Z,{className:"h-4 w-4 text-blue-500"}),value:formatAddress(e.walletAddress),type:"钱包地址"}:e.email?{icon:(0,a.jsx)(o.Z,{className:"h-4 w-4 text-green-500"}),value:e.email,type:"邮箱地址"}:{icon:(0,a.jsx)(u.Z,{className:"h-4 w-4 text-gray-500"}),value:"未知类型",type:"未知"};return 0===t.length?(0,a.jsxs)("div",{className:"card text-center py-12",children:[(0,a.jsx)(u.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"暂无联系人"}),(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"通过钱包地址或邮箱添加联系人开始转账"})]}):(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:t.map(e=>{let t=getContactDisplayInfo(e);return(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-1",children:e.name}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[t.icon,(0,a.jsx)("span",{className:"truncate",title:t.value,children:t.value})]}),(0,a.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:t.type})]}),(0,a.jsxs)("div",{className:"flex space-x-2 ml-4",children:[(0,a.jsx)("button",{onClick:()=>r(e),className:"text-primary-600 hover:text-primary-700 p-1",title:"转账",disabled:!e.walletAddress,children:(0,a.jsx)(h.Z,{className:"h-5 w-5 ".concat(e.walletAddress?"":"opacity-50 cursor-not-allowed")})}),(0,a.jsx)("button",{onClick:()=>handleDeleteContact(e.id),className:"text-red-600 hover:text-red-700 p-1",title:"删除",children:(0,a.jsx)(g.Z,{className:"h-5 w-5"})})]})]}),e.email&&!e.walletAddress&&(0,a.jsx)("div",{className:"mt-2 text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded",children:"无法获取钱包地址，暂不支持转账"})]},e.id)})})}function isValidEthereumAddress(e){return/^0x[a-fA-F0-9]{40}$/.test(e)}function isValidEmailAddress(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}async function checkEmailExists(e){try{let{exists:t}=await i.auth.checkEmailExists(e);return t}catch(t){return console.warn("Failed to check email via API, falling back to mock data:",t),await new Promise(e=>setTimeout(e,500)),["demo@example.com","alice@example.com","bob@example.com","charlie@example.com","test@example.com"].includes(e.toLowerCase())}}console.log("演示数据初始化完成");var p=s(2549),f=s(7972);function AddContactModal(e){let{userId:t,currentUser:s,onAdd:l,onClose:n}=e,[c,m]=(0,r.useState)({name:"",walletAddress:"",email:"",contactType:"wallet"}),[u,h]=(0,r.useState)(!1),[g,y]=(0,r.useState)(""),handleInputChange=e=>{let{name:t,value:s}=e.target;m(e=>({...e,[t]:s})),y("")},handleContactTypeChange=e=>{m(t=>({...t,contactType:e,walletAddress:"",email:""})),y("")},handleSubmit=async e=>{e.preventDefault(),h(!0),y("");try{let e;if("wallet"===c.contactType){if(!isValidEthereumAddress(c.walletAddress)){y("请输入有效的以太坊钱包地址");return}if(c.walletAddress.toLowerCase()===s.walletAddress.toLowerCase()){y("不能添加自己的钱包地址为联系人");return}if(d.isContactExists(t,c.walletAddress)){y("该钱包地址已经在您的联系人列表中");return}e={id:storage_generateId(),userId:t,name:c.name,walletAddress:c.walletAddress,createdAt:new Date().toISOString()}}else{if(!isValidEmailAddress(c.email)){y("请输入有效的邮箱地址");return}if(c.email.toLowerCase()===s.email.toLowerCase()){y("不能添加自己的邮箱地址为联系人");return}if(d.isContactExists(t,void 0,c.email)){y("该邮箱地址已经在您的联系人列表中");return}let a=await checkEmailExists(c.email);if(!a){y("该邮箱地址尚未注册，无法添加为联系人");return}try{let{user:s}=await i.auth.getUserByEmail(c.email);if(!s){y("无法获取该邮箱对应的用户信息");return}e={id:storage_generateId(),userId:t,name:c.name,email:c.email,walletAddress:s.aaAddress,createdAt:new Date().toISOString()}}catch(s){console.warn("Failed to get user by email via API, creating email-only contact:",s),e={id:storage_generateId(),userId:t,name:c.name,email:c.email,createdAt:new Date().toISOString()}}}l(e)}catch(e){y("添加联系人失败，请重试")}finally{h(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"添加联系人"}),(0,a.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 transition-colors",title:"关闭",children:(0,a.jsx)(p.Z,{className:"h-5 w-5"})})]}),(0,a.jsxs)("form",{onSubmit:handleSubmit,className:"p-6 space-y-4",children:[g&&(0,a.jsx)("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:g}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["添加方式 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>handleContactTypeChange("wallet"),className:"flex-1 flex items-center justify-center space-x-2 py-3 px-4 rounded-lg border transition-colors ".concat("wallet"===c.contactType?"border-primary-500 bg-primary-50 text-primary-700":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[(0,a.jsx)(x.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"钱包地址"})]}),(0,a.jsxs)("button",{type:"button",onClick:()=>handleContactTypeChange("email"),className:"flex-1 flex items-center justify-center space-x-2 py-3 px-4 rounded-lg border transition-colors ".concat("email"===c.contactType?"border-primary-500 bg-primary-50 text-primary-700":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[(0,a.jsx)(o.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"邮箱地址"})]})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"wallet"===c.contactType?"通过钱包地址直接添加联系人":"通过邮箱地址添加已注册用户为联系人"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:["备注名 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(f.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,a.jsx)("input",{type:"text",id:"name",name:"name",value:c.name,onChange:handleInputChange,className:"input-field pl-10",placeholder:"请输入联系人备注名",required:!0})]})]}),"wallet"===c.contactType?(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"walletAddress",className:"block text-sm font-medium text-gray-700 mb-1",children:["钱包地址 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,a.jsx)("input",{type:"text",id:"walletAddress",name:"walletAddress",value:c.walletAddress,onChange:handleInputChange,className:"input-field pl-10 font-mono",placeholder:"0x...",required:!0})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"请输入有效的以太坊钱包地址（以 0x 开头的 42 位十六进制字符）"})]}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:["邮箱地址 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(o.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,a.jsx)("input",{type:"email",id:"email",name:"email",value:c.email,onChange:handleInputChange,className:"input-field pl-10",placeholder:"example@email.com",required:!0})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"请输入已注册用户的邮箱地址，系统将验证该邮箱是否存在"})]}),(0,a.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:n,className:"flex-1 btn-secondary",children:"取消"}),(0,a.jsx)("button",{type:"submit",disabled:u,className:"flex-1 btn-primary",children:u?(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mx-auto"}):"添加联系人"})]})]})]})})}var y=s(1935),j=s(1298),b=s(9036);function TransferModal(e){let{fromUser:t,toContact:s,onTransfer:l,onClose:n}=e,[c,o]=(0,r.useState)({toAddress:s.walletAddress||"",amount:0,description:""}),[d,x]=(0,r.useState)(!1),[u,g]=(0,r.useState)(""),[N,w]=(0,r.useState)(""),handleInputChange=e=>{let{name:t,value:s}=e.target;o(e=>({...e,[t]:s})),g("")},handleSubmit=async e=>{if(e.preventDefault(),x(!0),g(""),!c.amount||c.amount<=0){g("请输入有效的转账金额"),x(!1);return}try{let e=y.fi(c.amount.toString()).toString();w("正在进行身份验证...");try{let{options:s}=await i.auth.loginStart(t.email);w("请完成生物识别验证...");let a=await verifyPasskeyCredential(s);w("正在创建转账...");let r=await i.transfer.createAndSendSignedTransfer({accountAddress:t.walletAddress,to:c.toAddress,value:e,passkeyVerification:{challenge:s.challenge,response:a,credentialPublicKey:t.credentialPublicKey||"",counter:t.counter||0}}),{userOperation:n,userOpHash:o}=r;w("转账已发送，等待确认...");let d={id:storage_generateId(),fromAddress:t.walletAddress,toAddress:c.toAddress,amount:c.amount,status:"pending",description:c.description||void 0,createdAt:new Date().toISOString(),txHash:o};m.saveTransfer(d),l(d)}catch(i){var s,a,r;if(console.warn("Real transfer API failed, falling back to simulation:",i),(null===(s=i.message)||void 0===s?void 0:s.includes("User cancelled"))||(null===(a=i.message)||void 0===a?void 0:a.includes("AbortError"))){g("用户取消了生物识别验证");return}if(null===(r=i.message)||void 0===r?void 0:r.includes("NotAllowedError")){g("生物识别验证失败，请重试");return}w("转账API不可用，使用模拟模式...");let e="0x".concat(Array.from(crypto.getRandomValues(new Uint8Array(32))).map(e=>e.toString(16).padStart(2,"0")).join("")),n={id:storage_generateId(),fromAddress:t.walletAddress,toAddress:c.toAddress,amount:c.amount,status:"completed",description:c.description||void 0,createdAt:new Date().toISOString(),txHash:e};m.saveTransfer(n),l(n)}}catch(e){g("转账失败，请重试")}finally{x(!1),w("")}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"转账给联系人"}),(0,a.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 transition-colors",title:"关闭",children:(0,a.jsx)(p.Z,{className:"h-5 w-5"})})]}),(0,a.jsxs)("form",{onSubmit:handleSubmit,className:"p-6 space-y-4",children:[u&&(0,a.jsx)("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:u}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"收款人"}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(f.Z,{className:"h-4 w-4 text-primary-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:s.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500 font-mono",children:s.walletAddress?formatAddress(s.walletAddress):"无钱包地址"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 mb-1",children:["转账金额 (ETH) ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(j.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,a.jsx)("input",{type:"number",id:"amount",name:"amount",value:c.amount,onChange:handleInputChange,className:"input-field pl-10",placeholder:"0.00",min:"0.00001",step:"0.00001",required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"转账说明"}),(0,a.jsx)("textarea",{id:"description",name:"description",value:c.description,onChange:handleInputChange,className:"input-field resize-none",rows:3,placeholder:"请输入转账说明（可选）"})]}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(b.Z,{className:"h-4 w-4 text-blue-600"}),(0,a.jsx)("span",{className:"text-sm text-blue-800 font-medium",children:"安全验证"})]}),(0,a.jsx)("p",{className:"text-xs text-blue-700 mt-1",children:"转账需要通过生物识别或硬件密钥验证，确保交易安全"})]}),(0,a.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:n,className:"flex-1 btn-secondary",children:"取消"}),(0,a.jsx)("button",{type:"submit",disabled:d,className:"flex-1 btn-primary",children:d?(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,a.jsx)("span",{className:"text-sm",children:N||"处理中..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"确认转账"]})})]})]})]})})}var N=s(3008),w=s(6141),v=s(2104),C=s(8783),S=s(1274);function TransferHistory(e){let{transfers:t,user:s}=e,getStatusIcon=e=>{switch(e){case"completed":return(0,a.jsx)(N.Z,{className:"h-4 w-4 text-green-500"});case"pending":return(0,a.jsx)(w.Z,{className:"h-4 w-4 text-yellow-500"});case"failed":return(0,a.jsx)(v.Z,{className:"h-4 w-4 text-red-500"});default:return(0,a.jsx)(w.Z,{className:"h-4 w-4 text-gray-400"})}},getStatusText=e=>{switch(e){case"completed":return"已完成";case"pending":return"处理中";case"failed":return"失败";default:return"未知"}},getTransferType=e=>e.fromAddress.toLowerCase()===s.walletAddress.toLowerCase()?"outgoing":"incoming",getTransferDescription=e=>e.fromAddress.toLowerCase()===s.walletAddress.toLowerCase()?"转账给 ".concat(e.toAddress):"收到来自 ".concat(e.fromAddress," 的转账");return 0===t.length?(0,a.jsxs)("div",{className:"card text-center py-12",children:[(0,a.jsx)(C.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"暂无转账记录"}),(0,a.jsx)("p",{className:"text-gray-500",children:"您的转账记录将显示在这里"})]}):(0,a.jsx)("div",{className:"space-y-4",children:t.map(e=>{let t="outgoing"===getTransferType(e);return(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(t?"bg-red-100":"bg-green-100"),children:t?(0,a.jsx)(C.Z,{className:"h-5 w-5 text-red-600"}):(0,a.jsx)(S.Z,{className:"h-5 w-5 text-green-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:getTransferDescription(e)}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:formatDate(e.createdAt)}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-lg font-semibold ".concat(t?"text-red-600":"text-green-600"),children:[t?"-":"+",formatCurrency(e.amount)]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 mt-1",children:[getStatusIcon(e.status),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:getStatusText(e.status)})]})]})]})},e.id)})})}var A=s(5883),k=s(5750),T=s(9883);function Dashboard(e){let{user:t,onLogout:s}=e,[l,n]=(0,r.useState)([]),[i,c]=(0,r.useState)([]),[o,u]=(0,r.useState)("contacts"),[h,g]=(0,r.useState)(!1),[p,y]=(0,r.useState)(!1),[j,b]=(0,r.useState)(null);(0,r.useEffect)(()=>{loadContacts(),loadTransfers()},[t.id]);let loadContacts=()=>{let e=d.getUserContacts(t.id);n(e)},loadTransfers=()=>{let e=m.getUserTransfers(t.id);c(e)};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("nav",{className:"bg-white shadow-sm border-b",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"FrontDoor Demo"})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:t.name}),t.hasPasskey&&(0,a.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"Passkey"})]}),(0,a.jsxs)("button",{onClick:s,className:"flex items-center space-x-1 text-gray-600 hover:text-gray-900",children:[(0,a.jsx)(A.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"退出"})]})]})]})})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsx)("div",{className:"card mb-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:["欢迎回来，",t.name,"！"]}),(0,a.jsx)("p",{className:"text-gray-600",children:t.email}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["注册时间：",formatDate(t.createdAt)]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-primary-600",children:l.length}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"联系人"})]})]})}),(0,a.jsxs)("div",{className:"flex space-x-1 bg-white rounded-lg p-1 shadow-sm mb-6",children:[(0,a.jsxs)("button",{onClick:()=>u("contacts"),className:"flex-1 flex items-center justify-center space-x-2 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("contacts"===o?"bg-primary-600 text-white":"text-gray-600 hover:text-gray-900"),children:[(0,a.jsx)(k.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"联系人管理"})]}),(0,a.jsxs)("button",{onClick:()=>u("transfers"),className:"flex-1 flex items-center justify-center space-x-2 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("transfers"===o?"bg-primary-600 text-white":"text-gray-600 hover:text-gray-900"),children:[(0,a.jsx)(x.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"转账记录"})]})]}),"contacts"===o&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"联系人列表"}),(0,a.jsxs)("button",{onClick:()=>g(!0),className:"btn-primary flex items-center space-x-2",children:[(0,a.jsx)(T.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"添加联系人"})]})]}),(0,a.jsx)(ContactList,{contacts:l,onDelete:e=>{d.deleteContact(e),loadContacts()},onTransfer:e=>{b(e),y(!0)}})]}),"transfers"===o&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"转账记录"}),(0,a.jsx)(TransferHistory,{transfers:i,user:t})]})]}),h&&(0,a.jsx)(AddContactModal,{userId:t.id,currentUser:t,onAdd:e=>{let s={...e,id:Date.now().toString(),userId:t.id,createdAt:new Date().toISOString()};d.saveContact(s),loadContacts(),g(!1)},onClose:()=>g(!1)}),p&&j&&(0,a.jsx)(TransferModal,{fromUser:t,toContact:j,onTransfer:e=>{let t={...e,id:Date.now().toString(),status:"pending",createdAt:new Date().toISOString()};m.saveTransfer(t),loadTransfers(),y(!1),b(null)},onClose:()=>{y(!1),b(null)}})]})}function HomePage(){let[e,t]=(0,r.useState)(null),[s,l]=(0,r.useState)(!1),[n,i]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{isPasskeyAvailable().then(i)},[]),n)?e?(0,a.jsx)(Dashboard,{user:e,onLogout:()=>{t(null)}}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"w-full max-w-md",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"FrontDoor Demo"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Web3 钱包转账演示"}),(0,a.jsxs)("div",{className:"mt-2 inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800",children:[(0,a.jsx)("span",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Passkey 可用"]})]}),(0,a.jsx)("div",{className:"card",children:s?(0,a.jsx)(RegisterForm,{onRegister:e=>{t(e)},onSwitchToLogin:()=>l(!1)}):(0,a.jsx)(LoginForm,{onLogin:e=>{t(e)},onSwitchToRegister:()=>l(!0)})})]})}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"w-full max-w-md text-center",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"浏览器不支持 Passkey"}),(0,a.jsx)("p",{className:"text-gray-600",children:"请使用支持 Passkey 的现代浏览器访问本应用。 推荐使用 Chrome、Safari 或 Edge 的最新版本。"})]})})}}},function(e){e.O(0,[316,971,472,744],function(){return e(e.s=2555)}),_N_E=e.O()}]);