(()=>{var e={};e.id=931,e.ids=[931],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7310:e=>{"use strict";e.exports=require("url")},9141:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>c,routeModule:()=>u,tree:()=>d});var a=s(7096),r=s(6132),n=s(7284),l=s.n(n),i=s(2564),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);s.d(t,o);let d=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,3982)),"/Users/chao/Codes/YetAnotherAA/aastar-frontend/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,5345)),"/Users/chao/Codes/YetAnotherAA/aastar-frontend/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9291,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/chao/Codes/YetAnotherAA/aastar-frontend/app/page.tsx"],m="/page",x={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},816:(e,t,s)=>{Promise.resolve().then(s.bind(s,5789))},5789:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>HomePage});var a=s(784),r=s(9885),n=s(2655);async function isPasskeyAvailable(){return!!window.PublicKeyCredential&&await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()}async function verifyPasskeyCredential(e){return await (0,n.oz)({optionsJSON:e})}let l="http://localhost:3001";let ApiError=class ApiError extends Error{constructor(e,t){super(t),this.status=e,this.name="ApiError"}};async function apiRequest(e,t={}){let s=`${l}${e}`,a=await fetch(s,{headers:{"Content-Type":"application/json",...t.headers},...t}),r=await a.json();if(!a.ok)throw new ApiError(a.status,r.message||`API request failed: ${a.status} ${a.statusText}`);return r}let i={auth:{checkEmailExists:async e=>apiRequest(`/auth/email/check/${encodeURIComponent(e)}`,{method:"GET"}),getUserByEmail:async e=>apiRequest(`/auth/user/email/${encodeURIComponent(e)}`,{method:"GET"}),registerStart:async e=>apiRequest("/auth/register/start",{method:"POST",body:JSON.stringify({email:e})}),registerComplete:async e=>apiRequest("/auth/register/complete",{method:"POST",body:JSON.stringify(e)}),loginStart:async e=>apiRequest("/auth/login/start",{method:"POST",body:JSON.stringify({email:e})}),loginComplete:async e=>apiRequest("/auth/login/complete",{method:"POST",body:JSON.stringify(e)})},transfer:{createTransfer:async e=>{let t={to:e.toAddress,value:e.amount,data:"0x",operation:0};return apiRequest("/api/userop",{method:"POST",body:JSON.stringify({accountAddress:e.accountAddress,txRequest:t,paymasterEnabled:!1})})},sendTransfer:async e=>apiRequest("/api/userop/send",{method:"POST",body:JSON.stringify(e)}),estimateTransferGas:async e=>{let t={to:e.toAddress,value:e.amount,data:"0x",operation:0};return apiRequest("/api/userop/estimate",{method:"POST",body:JSON.stringify({accountAddress:e.accountAddress,txRequest:t,paymasterEnabled:!1})})},createAndSendSignedTransfer:async e=>{try{let t=await fetch(`${l}/userop/signed`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountAddress:e.accountAddress,txRequest:{to:e.to,value:e.value,data:e.data||"0x",operation:0},paymasterEnabled:e.paymasterEnabled||!1,passkeyVerification:e.passkeyVerification,requiredNodeCount:e.requiredNodeCount||3})});if(!t.ok){let e=await t.json();throw Error(e.message||"Transfer failed")}let s=await t.json();return console.log("带BLS签名的转账成功:",s),s}catch(e){throw console.error("带BLS签名的转账失败:",e),e}},prepareSignedTransfer:async e=>{try{let t=await fetch(`${l}/userop/prepare`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountAddress:e.accountAddress,txRequest:{to:e.to,value:e.value,data:e.data||"0x",operation:0},paymasterEnabled:e.paymasterEnabled||!1,passkeyVerification:e.passkeyVerification,requiredNodeCount:e.requiredNodeCount||3})});if(!t.ok){let e=await t.json();throw Error(e.message||"Prepare transfer failed")}let s=await t.json();return console.log("转账准备完成:",s),s}catch(e){throw console.error("转账准备失败:",e),e}}}};var o=s(7800),d=s(9490);function LoginForm({onLogin:e,onSwitchToRegister:t}){let[s,n]=(0,r.useState)(""),[l,c]=(0,r.useState)(!1),[m,x]=(0,r.useState)(""),[u,h]=(0,r.useState)(!1),handlePasskeyLogin=async()=>{c(!0),x("");try{let{options:t}=await i.auth.loginStart(""),s=await verifyPasskeyCredential(t),{user:a}=await i.auth.loginComplete({credentialId:s.id,response:s,challenge:t.challenge}),r={id:a.credentialId,email:a.email,name:a.email.split("@")[0],walletAddress:a.aaAddress,hasPasskey:!0,createdAt:a.createdAt};e(r)}catch(e){console.error("登录失败:",e),e instanceof ApiError?404===e.status?x("未找到 Passkey，请先注册或使用邮箱恢复账号"):401===e.status?x("Passkey 验证失败，请重试"):x(e.message):x("登录失败，请重试")}finally{c(!1)}},handleEmailRecovery=async e=>{if(e.preventDefault(),!s){x("请输入邮箱地址");return}c(!0),x("");try{x("邮箱恢复功能尚未实现")}catch(e){console.error("恢复失败:",e),x("账号恢复失败，请重试")}finally{c(!1)}};return(0,a.jsxs)("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-center mb-6",children:"登录"}),m&&a.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:m}),(0,a.jsxs)("div",{className:"mb-8",children:[a.jsx("button",{onClick:handlePasskeyLogin,disabled:l,className:"btn-primary w-full flex items-center justify-center py-4 text-lg",children:l?a.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(o.Z,{className:"h-6 w-6 mr-3"}),"使用 Passkey 登录"]})}),a.jsx("p",{className:"text-sm text-gray-500 text-center mt-2",children:"点击按钮，使用您的指纹、面容或设备密码登录"})]}),(0,a.jsxs)("div",{className:"relative mb-6",children:[a.jsx("div",{className:"absolute inset-0 flex items-center",children:a.jsx("div",{className:"w-full border-t border-gray-300"})}),a.jsx("div",{className:"relative flex justify-center text-sm",children:a.jsx("span",{className:"px-2 bg-white text-gray-500",children:"遇到问题？"})})]}),u?(0,a.jsxs)("form",{onSubmit:handleEmailRecovery,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"注册时使用的邮箱地址"}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx(d.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),a.jsx("input",{type:"email",id:"email",name:"email",value:s,onChange:e=>{n(e.target.value),x("")},className:"input-field pl-10",placeholder:"请输入邮箱地址",required:!0})]})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[a.jsx("button",{type:"button",onClick:()=>{h(!1),n(""),x("")},className:"btn-secondary flex-1",children:"取消"}),a.jsx("button",{type:"submit",disabled:l,className:"btn-primary flex-1 flex items-center justify-center",children:l?a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):"发送恢复链接"})]})]}):(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("button",{onClick:()=>h(!0),className:"text-primary-600 hover:text-primary-700 text-sm font-medium",children:[a.jsx(d.Z,{className:"h-4 w-4 mr-1 inline"}),"通过邮箱恢复账号"]}),a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"适用于更换设备或无法使用 Passkey 的情况"})]}),a.jsx("div",{className:"mt-8 text-center",children:(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["还没有账号？"," ",a.jsx("button",{onClick:t,className:"text-primary-600 hover:text-primary-700 font-medium",children:"立即注册"})]})})]})}function RegisterForm({onRegister:e,onSwitchToLogin:t}){let[s,l]=(0,r.useState)(""),[o,d]=(0,r.useState)(!1),[c,m]=(0,r.useState)(""),[x,u]=(0,r.useState)(!1),handleRegister=async t=>{t.preventDefault(),d(!0),m(""),u(!1);try{let t;console.log("Starting registration for email:",s);let{options:a}=await i.auth.registerStart(s);console.log("Registration options received:",a);try{console.log("Starting WebAuthn registration...");let e={...a,challenge:a.challenge,user:{...a.user,id:a.user.id},excludeCredentials:a.excludeCredentials||[]};console.log("Processed registration options:",e),t=await (0,n.RQ)({optionsJSON:e}),console.log("WebAuthn registration successful:",t)}catch(e){if(console.error("WebAuthn registration error:",e),console.error("Error name:",e?.name),console.error("Error message:",e?.message),console.error("Error stack:",e?.stack),e?.name==="NotAllowedError")throw Error("用户取消了 Passkey 创建或操作超时");if(e?.name==="InvalidStateError")throw Error("该邮箱已经注册过 Passkey，请尝试登录");if(e?.name==="NotSupportedError")throw Error("您的设备或浏览器不支持 Passkey 功能");if(e?.name==="SecurityError")throw Error("安全错误：请确保在安全的 HTTPS 环境下使用");else if(e?.message?.includes("RESULT_CODE_KILLED_BAD_MESSAGE"))throw Error("Passkey 创建失败：数据格式错误，请重试");else throw Error(`创建 Passkey 失败: ${e?.message||"未知错误"}`)}console.log("Completing registration...");let{user:r}=await i.auth.registerComplete({email:s,response:t,challenge:a.challenge});if(u(!0),console.log("Registration successful:",r),e){let t={id:r.credentialId,email:r.email,name:s.split("@")[0],walletAddress:r.aaAddress,hasPasskey:!0,createdAt:new Date().toISOString()};e(t)}}catch(e){console.error("Registration error:",e),m(e instanceof Error?e.message:"注册失败，请重试")}finally{d(!1)}};return a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,a.jsxs)("div",{children:[a.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"注册账户"}),a.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"使用 Passkey 注册新账户"})]}),c&&a.jsx("div",{className:"rounded-md bg-red-50 p-4",children:a.jsx("div",{className:"flex",children:a.jsx("div",{className:"ml-3",children:a.jsx("h3",{className:"text-sm font-medium text-red-800",children:c})})})}),x&&a.jsx("div",{className:"rounded-md bg-green-50 p-4",children:a.jsx("div",{className:"flex",children:a.jsx("div",{className:"ml-3",children:a.jsx("h3",{className:"text-sm font-medium text-green-800",children:"注册成功！"})})})}),(0,a.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:handleRegister,children:[a.jsx("div",{className:"rounded-md shadow-sm -space-y-px",children:(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"email",className:"sr-only",children:"邮箱地址"}),a.jsx("input",{id:"email",name:"email",type:"email",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"邮箱地址",value:s,onChange:e=>l(e.target.value),disabled:o})]})}),a.jsx("div",{children:a.jsx("button",{type:"submit",disabled:o,className:`group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white ${o?"bg-indigo-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}`,children:o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"注册中..."]}):"使用 Passkey 注册"})}),t&&a.jsx("div",{className:"text-center",children:a.jsx("button",{type:"button",onClick:t,className:"text-sm text-indigo-600 hover:text-indigo-500",children:"已有账号？点击登录"})})]})]})})}function storage_generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}function formatDate(e){return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function formatAddress(e){return e?`${e.slice(0,6)}...${e.slice(-4)}`:""}let c={saveContact(e){let t=this.getContacts();t.push(e),localStorage.setItem("contacts",JSON.stringify(t))},getContacts(){let e=localStorage.getItem("contacts");return e?JSON.parse(e):[]},getUserContacts(e){let t=this.getContacts();return t.filter(t=>t.userId===e)},getContactByAddress(e){let t=this.getContacts();return t.find(t=>t.walletAddress&&t.walletAddress.toLowerCase()===e.toLowerCase())||null},getContactByEmail(e){let t=this.getContacts();return t.find(t=>t.email&&t.email.toLowerCase()===e.toLowerCase())||null},isContactExists(e,t,s){let a=this.getUserContacts(e);return t?a.some(e=>e.walletAddress&&e.walletAddress.toLowerCase()===t.toLowerCase()):!!s&&a.some(e=>e.email&&e.email.toLowerCase()===s.toLowerCase())},updateContact(e){let t=this.getContacts(),s=t.findIndex(t=>t.id===e.id);-1!==s&&(t[s]=e,localStorage.setItem("contacts",JSON.stringify(t)))},deleteContact(e){let t=this.getContacts(),s=t.filter(t=>t.id!==e);localStorage.setItem("contacts",JSON.stringify(s))}},m={saveTransfer(e){let t=this.getTransfers();t.push(e),localStorage.setItem("transfers",JSON.stringify(t))},getTransfers(){let e=localStorage.getItem("transfers");return e?JSON.parse(e):[]},getUserTransfers(e){let t=this.getTransfers();return t.filter(t=>t.fromAddress.toLowerCase()===e.toLowerCase()||t.toAddress.toLowerCase()===e.toLowerCase())},updateTransfer(e){let t=this.getTransfers(),s=t.findIndex(t=>t.id===e.id);-1!==s&&(t[s]=e,localStorage.setItem("transfers",JSON.stringify(t)))}},formatCurrency=(e,t="CNY")=>new Intl.NumberFormat("zh-CN",{style:"currency",currency:t}).format(e);var x=s(1163),u=s(7018),h=s(8089),p=s(6303);function ContactList({contacts:e,onDelete:t,onTransfer:s}){let handleDeleteContact=e=>{confirm("确定要删除这个联系人吗？")&&t(e)},getContactDisplayInfo=e=>e.walletAddress?{icon:a.jsx(x.Z,{className:"h-4 w-4 text-blue-500"}),value:formatAddress(e.walletAddress),type:"钱包地址"}:e.email?{icon:a.jsx(d.Z,{className:"h-4 w-4 text-green-500"}),value:e.email,type:"邮箱地址"}:{icon:a.jsx(u.Z,{className:"h-4 w-4 text-gray-500"}),value:"未知类型",type:"未知"};return 0===e.length?(0,a.jsxs)("div",{className:"card text-center py-12",children:[a.jsx(u.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"暂无联系人"}),a.jsx("p",{className:"text-gray-500 mb-4",children:"通过钱包地址或邮箱添加联系人开始转账"})]}):a.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:e.map(e=>{let t=getContactDisplayInfo(e);return(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:e.name}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[t.icon,a.jsx("span",{className:"truncate",title:t.value,children:t.value})]}),a.jsx("div",{className:"text-xs text-gray-400 mt-1",children:t.type})]}),(0,a.jsxs)("div",{className:"flex space-x-2 ml-4",children:[a.jsx("button",{onClick:()=>s(e),className:"text-primary-600 hover:text-primary-700 p-1",title:"转账",disabled:!e.walletAddress,children:a.jsx(h.Z,{className:`h-5 w-5 ${e.walletAddress?"":"opacity-50 cursor-not-allowed"}`})}),a.jsx("button",{onClick:()=>handleDeleteContact(e.id),className:"text-red-600 hover:text-red-700 p-1",title:"删除",children:a.jsx(p.Z,{className:"h-5 w-5"})})]})]}),e.email&&!e.walletAddress&&a.jsx("div",{className:"mt-2 text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded",children:"无法获取钱包地址，暂不支持转账"})]},e.id)})})}function isValidEthereumAddress(e){return/^0x[a-fA-F0-9]{40}$/.test(e)}function isValidEmailAddress(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}async function checkEmailExists(e){try{let{exists:t}=await i.auth.checkEmailExists(e);return t}catch(t){return console.warn("Failed to check email via API, falling back to mock data:",t),await new Promise(e=>setTimeout(e,500)),["demo@example.com","alice@example.com","bob@example.com","charlie@example.com","test@example.com"].includes(e.toLowerCase())}}console.log("演示数据初始化完成");var g=s(6206),f=s(3680);function AddContactModal({userId:e,currentUser:t,onAdd:s,onClose:n}){let[l,o]=(0,r.useState)({name:"",walletAddress:"",email:"",contactType:"wallet"}),[m,u]=(0,r.useState)(!1),[h,p]=(0,r.useState)(""),handleInputChange=e=>{let{name:t,value:s}=e.target;o(e=>({...e,[t]:s})),p("")},handleContactTypeChange=e=>{o(t=>({...t,contactType:e,walletAddress:"",email:""})),p("")},handleSubmit=async a=>{a.preventDefault(),u(!0),p("");try{let a;if("wallet"===l.contactType){if(!isValidEthereumAddress(l.walletAddress)){p("请输入有效的以太坊钱包地址");return}if(l.walletAddress.toLowerCase()===t.walletAddress.toLowerCase()){p("不能添加自己的钱包地址为联系人");return}if(c.isContactExists(e,l.walletAddress)){p("该钱包地址已经在您的联系人列表中");return}a={id:storage_generateId(),userId:e,name:l.name,walletAddress:l.walletAddress,createdAt:new Date().toISOString()}}else{if(!isValidEmailAddress(l.email)){p("请输入有效的邮箱地址");return}if(l.email.toLowerCase()===t.email.toLowerCase()){p("不能添加自己的邮箱地址为联系人");return}if(c.isContactExists(e,void 0,l.email)){p("该邮箱地址已经在您的联系人列表中");return}let s=await checkEmailExists(l.email);if(!s){p("该邮箱地址尚未注册，无法添加为联系人");return}try{let{user:t}=await i.auth.getUserByEmail(l.email);if(!t){p("无法获取该邮箱对应的用户信息");return}a={id:storage_generateId(),userId:e,name:l.name,email:l.email,walletAddress:t.aaAddress,createdAt:new Date().toISOString()}}catch(t){console.warn("Failed to get user by email via API, creating email-only contact:",t),a={id:storage_generateId(),userId:e,name:l.name,email:l.email,createdAt:new Date().toISOString()}}}s(a)}catch(e){p("添加联系人失败，请重试")}finally{u(!1)}};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"添加联系人"}),a.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 transition-colors",title:"关闭",children:a.jsx(g.Z,{className:"h-5 w-5"})})]}),(0,a.jsxs)("form",{onSubmit:handleSubmit,className:"p-6 space-y-4",children:[h&&a.jsx("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:h}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["添加方式 ",a.jsx("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>handleContactTypeChange("wallet"),className:`flex-1 flex items-center justify-center space-x-2 py-3 px-4 rounded-lg border transition-colors ${"wallet"===l.contactType?"border-primary-500 bg-primary-50 text-primary-700":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"}`,children:[a.jsx(x.Z,{className:"h-5 w-5"}),a.jsx("span",{children:"钱包地址"})]}),(0,a.jsxs)("button",{type:"button",onClick:()=>handleContactTypeChange("email"),className:`flex-1 flex items-center justify-center space-x-2 py-3 px-4 rounded-lg border transition-colors ${"email"===l.contactType?"border-primary-500 bg-primary-50 text-primary-700":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"}`,children:[a.jsx(d.Z,{className:"h-5 w-5"}),a.jsx("span",{children:"邮箱地址"})]})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"wallet"===l.contactType?"通过钱包地址直接添加联系人":"通过邮箱地址添加已注册用户为联系人"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:["备注名 ",a.jsx("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx(f.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),a.jsx("input",{type:"text",id:"name",name:"name",value:l.name,onChange:handleInputChange,className:"input-field pl-10",placeholder:"请输入联系人备注名",required:!0})]})]}),"wallet"===l.contactType?(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"walletAddress",className:"block text-sm font-medium text-gray-700 mb-1",children:["钱包地址 ",a.jsx("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx(x.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),a.jsx("input",{type:"text",id:"walletAddress",name:"walletAddress",value:l.walletAddress,onChange:handleInputChange,className:"input-field pl-10 font-mono",placeholder:"0x...",required:!0})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"请输入有效的以太坊钱包地址（以 0x 开头的 42 位十六进制字符）"})]}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:["邮箱地址 ",a.jsx("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx(d.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),a.jsx("input",{type:"email",id:"email",name:"email",value:l.email,onChange:handleInputChange,className:"input-field pl-10",placeholder:"example@email.com",required:!0})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"请输入已注册用户的邮箱地址，系统将验证该邮箱是否存在"})]}),(0,a.jsxs)("div",{className:"flex space-x-3 pt-4",children:[a.jsx("button",{type:"button",onClick:n,className:"flex-1 btn-secondary",children:"取消"}),a.jsx("button",{type:"submit",disabled:m,className:"flex-1 btn-primary",children:m?a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mx-auto"}):"添加联系人"})]})]})]})})}var y=s(5763),j=s(6908),b=s(4901);function TransferModal({fromUser:e,toContact:t,onTransfer:s,onClose:n}){let[l,o]=(0,r.useState)({toAddress:t.walletAddress||"",amount:0,description:""}),[d,c]=(0,r.useState)(!1),[x,u]=(0,r.useState)(""),[p,N]=(0,r.useState)(""),handleInputChange=e=>{let{name:t,value:s}=e.target;o(e=>({...e,[t]:s})),u("")},handleSubmit=async t=>{if(t.preventDefault(),c(!0),u(""),!l.amount||l.amount<=0){u("请输入有效的转账金额"),c(!1);return}try{let t=y.fi(l.amount.toString()).toString();N("正在进行身份验证...");try{let{options:a}=await i.auth.loginStart(e.email);N("请完成生物识别验证...");let r=await verifyPasskeyCredential(a);N("正在创建转账...");let n=await i.transfer.createAndSendSignedTransfer({accountAddress:e.walletAddress,to:l.toAddress,value:t,passkeyVerification:{challenge:a.challenge,response:r,credentialPublicKey:e.credentialPublicKey||"",counter:e.counter||0}}),{userOperation:o,userOpHash:d}=n;N("转账已发送，等待确认...");let c={id:storage_generateId(),fromAddress:e.walletAddress,toAddress:l.toAddress,amount:l.amount,status:"pending",description:l.description||void 0,createdAt:new Date().toISOString(),txHash:d};m.saveTransfer(c),s(c)}catch(r){if(console.warn("Real transfer API failed, falling back to simulation:",r),r.message?.includes("User cancelled")||r.message?.includes("AbortError")){u("用户取消了生物识别验证");return}if(r.message?.includes("NotAllowedError")){u("生物识别验证失败，请重试");return}N("转账API不可用，使用模拟模式...");let t=`0x${Array.from(crypto.getRandomValues(new Uint8Array(32))).map(e=>e.toString(16).padStart(2,"0")).join("")}`,a={id:storage_generateId(),fromAddress:e.walletAddress,toAddress:l.toAddress,amount:l.amount,status:"completed",description:l.description||void 0,createdAt:new Date().toISOString(),txHash:t};m.saveTransfer(a),s(a)}}catch(e){u("转账失败，请重试")}finally{c(!1),N("")}};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"转账给联系人"}),a.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 transition-colors",title:"关闭",children:a.jsx(g.Z,{className:"h-5 w-5"})})]}),(0,a.jsxs)("form",{onSubmit:handleSubmit,className:"p-6 space-y-4",children:[x&&a.jsx("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:x}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"收款人"}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center",children:a.jsx(f.Z,{className:"h-4 w-4 text-primary-600"})}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:t.name}),a.jsx("p",{className:"text-sm text-gray-500 font-mono",children:t.walletAddress?formatAddress(t.walletAddress):"无钱包地址"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 mb-1",children:["转账金额 (ETH) ",a.jsx("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx(j.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),a.jsx("input",{type:"number",id:"amount",name:"amount",value:l.amount,onChange:handleInputChange,className:"input-field pl-10",placeholder:"0.00",min:"0.00001",step:"0.00001",required:!0})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"转账说明"}),a.jsx("textarea",{id:"description",name:"description",value:l.description,onChange:handleInputChange,className:"input-field resize-none",rows:3,placeholder:"请输入转账说明（可选）"})]}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(b.Z,{className:"h-4 w-4 text-blue-600"}),a.jsx("span",{className:"text-sm text-blue-800 font-medium",children:"安全验证"})]}),a.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"转账需要通过生物识别或硬件密钥验证，确保交易安全"})]}),(0,a.jsxs)("div",{className:"flex space-x-3 pt-4",children:[a.jsx("button",{type:"button",onClick:n,className:"flex-1 btn-secondary",children:"取消"}),a.jsx("button",{type:"submit",disabled:d,className:"flex-1 btn-primary",children:d?(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),a.jsx("span",{className:"text-sm",children:p||"处理中..."})]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(h.Z,{className:"h-4 w-4 mr-2"}),"确认转账"]})})]})]})]})})}var N=s(2032),w=s(5441),v=s(1057),C=s(1443),A=s(3134);function TransferHistory({transfers:e,user:t}){let getStatusIcon=e=>{switch(e){case"completed":return a.jsx(N.Z,{className:"h-4 w-4 text-green-500"});case"pending":return a.jsx(w.Z,{className:"h-4 w-4 text-yellow-500"});case"failed":return a.jsx(v.Z,{className:"h-4 w-4 text-red-500"});default:return a.jsx(w.Z,{className:"h-4 w-4 text-gray-400"})}},getStatusText=e=>{switch(e){case"completed":return"已完成";case"pending":return"处理中";case"failed":return"失败";default:return"未知"}},getTransferType=e=>e.fromAddress.toLowerCase()===t.walletAddress.toLowerCase()?"outgoing":"incoming",getTransferDescription=e=>e.fromAddress.toLowerCase()===t.walletAddress.toLowerCase()?`转账给 ${e.toAddress}`:`收到来自 ${e.fromAddress} 的转账`;return 0===e.length?(0,a.jsxs)("div",{className:"card text-center py-12",children:[a.jsx(C.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"暂无转账记录"}),a.jsx("p",{className:"text-gray-500",children:"您的转账记录将显示在这里"})]}):a.jsx("div",{className:"space-y-4",children:e.map(e=>{let t="outgoing"===getTransferType(e);return a.jsx("div",{className:"card",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${t?"bg-red-100":"bg-green-100"}`,children:t?a.jsx(C.Z,{className:"h-5 w-5 text-red-600"}):a.jsx(A.Z,{className:"h-5 w-5 text-green-600"})}),(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:getTransferDescription(e)}),a.jsx("p",{className:"text-sm text-gray-500",children:formatDate(e.createdAt)}),e.description&&a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:`text-lg font-semibold ${t?"text-red-600":"text-green-600"}`,children:[t?"-":"+",formatCurrency(e.amount)]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 mt-1",children:[getStatusIcon(e.status),a.jsx("span",{className:"text-xs text-gray-500",children:getStatusText(e.status)})]})]})]})},e.id)})})}var S=s(92),k=s(1672),T=s(2385);function Dashboard({user:e,onLogout:t}){let[s,n]=(0,r.useState)([]),[l,i]=(0,r.useState)([]),[o,d]=(0,r.useState)("contacts"),[u,h]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1),[y,j]=(0,r.useState)(null);(0,r.useEffect)(()=>{loadContacts(),loadTransfers()},[e.id]);let loadContacts=()=>{let t=c.getUserContacts(e.id);n(t)},loadTransfers=()=>{let t=m.getUserTransfers(e.id);i(t)};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("nav",{className:"bg-white shadow-sm border-b",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[a.jsx("div",{className:"flex items-center",children:a.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"FrontDoor Demo"})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[a.jsx(f.Z,{className:"h-4 w-4"}),a.jsx("span",{children:e.name}),e.hasPasskey&&a.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"Passkey"})]}),(0,a.jsxs)("button",{onClick:t,className:"flex items-center space-x-1 text-gray-600 hover:text-gray-900",children:[a.jsx(S.Z,{className:"h-4 w-4"}),a.jsx("span",{children:"退出"})]})]})]})})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[a.jsx("div",{className:"card mb-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:["欢迎回来，",e.name,"！"]}),a.jsx("p",{className:"text-gray-600",children:e.email}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["注册时间：",formatDate(e.createdAt)]})]}),(0,a.jsxs)("div",{className:"text-right",children:[a.jsx("div",{className:"text-3xl font-bold text-primary-600",children:s.length}),a.jsx("div",{className:"text-sm text-gray-500",children:"联系人"})]})]})}),(0,a.jsxs)("div",{className:"flex space-x-1 bg-white rounded-lg p-1 shadow-sm mb-6",children:[(0,a.jsxs)("button",{onClick:()=>d("contacts"),className:`flex-1 flex items-center justify-center space-x-2 py-2 px-4 rounded-md text-sm font-medium transition-colors ${"contacts"===o?"bg-primary-600 text-white":"text-gray-600 hover:text-gray-900"}`,children:[a.jsx(k.Z,{className:"h-4 w-4"}),a.jsx("span",{children:"联系人管理"})]}),(0,a.jsxs)("button",{onClick:()=>d("transfers"),className:`flex-1 flex items-center justify-center space-x-2 py-2 px-4 rounded-md text-sm font-medium transition-colors ${"transfers"===o?"bg-primary-600 text-white":"text-gray-600 hover:text-gray-900"}`,children:[a.jsx(x.Z,{className:"h-4 w-4"}),a.jsx("span",{children:"转账记录"})]})]}),"contacts"===o&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"联系人列表"}),(0,a.jsxs)("button",{onClick:()=>h(!0),className:"btn-primary flex items-center space-x-2",children:[a.jsx(T.Z,{className:"h-4 w-4"}),a.jsx("span",{children:"添加联系人"})]})]}),a.jsx(ContactList,{contacts:s,onDelete:e=>{c.deleteContact(e),loadContacts()},onTransfer:e=>{j(e),g(!0)}})]}),"transfers"===o&&(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"转账记录"}),a.jsx(TransferHistory,{transfers:l,user:e})]})]}),u&&a.jsx(AddContactModal,{userId:e.id,currentUser:e,onAdd:t=>{let s={...t,id:Date.now().toString(),userId:e.id,createdAt:new Date().toISOString()};c.saveContact(s),loadContacts(),h(!1)},onClose:()=>h(!1)}),p&&y&&a.jsx(TransferModal,{fromUser:e,toContact:y,onTransfer:e=>{let t={...e,id:Date.now().toString(),status:"pending",createdAt:new Date().toISOString()};m.saveTransfer(t),loadTransfers(),g(!1),j(null)},onClose:()=>{g(!1),j(null)}})]})}function HomePage(){let[e,t]=(0,r.useState)(null),[s,n]=(0,r.useState)(!1),[l,i]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{isPasskeyAvailable().then(i)},[]),l)?e?a.jsx(Dashboard,{user:e,onLogout:()=>{t(null)}}):a.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"w-full max-w-md",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"FrontDoor Demo"}),a.jsx("p",{className:"text-gray-600",children:"Web3 钱包转账演示"}),(0,a.jsxs)("div",{className:"mt-2 inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800",children:[a.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Passkey 可用"]})]}),a.jsx("div",{className:"card",children:s?a.jsx(RegisterForm,{onRegister:e=>{t(e)},onSwitchToLogin:()=>n(!1)}):a.jsx(LoginForm,{onLogin:e=>{t(e)},onSwitchToRegister:()=>n(!0)})})]})}):a.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"w-full max-w-md text-center",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"浏览器不支持 Passkey"}),a.jsx("p",{className:"text-gray-600",children:"请使用支持 Passkey 的现代浏览器访问本应用。 推荐使用 Chrome、Safari 或 Edge 的最新版本。"})]})})}},3982:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>l,__esModule:()=>n,default:()=>o});var a=s(5153);let r=(0,a.createProxy)(String.raw`/Users/chao/Codes/YetAnotherAA/aastar-frontend/app/page.tsx`),{__esModule:n,$$typeof:l}=r,i=r.default,o=i}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[214,29,785],()=>__webpack_exec__(9141));module.exports=s})();