# AA Wallet Backend

ä¸­å¿ƒåŒ–åç«¯æœåŠ¡ï¼Œæ”¯æŒ Passkey + Email è®¤è¯ã€EOA é’±åŒ…ç®¡ç†å’Œ ERC-4337 è½¬è´¦åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” **Passkey è®¤è¯**: WebAuthn æ ‡å‡†çš„æ— å¯†ç è®¤è¯
- ğŸ“§ **é‚®ç®±éªŒè¯**: å®‰å…¨çš„é‚®ç®±éªŒè¯ç ç³»ç»Ÿ
- ğŸ‘› **EOA é’±åŒ…**: è‡ªåŠ¨ç”Ÿæˆå’Œç®¡ç†ä»¥å¤ªåŠå¤–éƒ¨è´¦æˆ·
- ğŸ”„ **ERC-4337**: è´¦æˆ·æŠ½è±¡è½¬è´¦åŠŸèƒ½
- ğŸ“ **JSON å­˜å‚¨**: åŸºäºæ–‡ä»¶çš„æ•°æ®å­˜å‚¨ï¼ˆå¯è¿ç§»è‡³ MongoDBï¼‰

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. é…ç½®ç¯å¢ƒ

å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼š
```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶é…ç½®ç›¸å…³å‚æ•°ã€‚

### 3. å¯åŠ¨å¼€å‘æœåŠ¡

```bash
npm run start:dev
```

åº”ç”¨å°†åœ¨ http://localhost:3000 å¯åŠ¨ã€‚

### 4. æŸ¥çœ‹ API æ–‡æ¡£

è®¿é—® http://localhost:3000/api æŸ¥çœ‹ Swagger API æ–‡æ¡£ã€‚

## API æ¥å£

### è®¤è¯ç›¸å…³
- `POST /auth/email/send-code` - å‘é€é‚®ç®±éªŒè¯ç 
- `POST /auth/email/verify-code` - éªŒè¯é‚®ç®±éªŒè¯ç 
- `POST /auth/passkey/register/begin` - å¼€å§‹ Passkey æ³¨å†Œ
- `POST /auth/passkey/register/complete` - å®Œæˆ Passkey æ³¨å†Œ
- `POST /auth/passkey/login/begin` - å¼€å§‹ Passkey ç™»å½•
- `POST /auth/passkey/login/complete` - å®Œæˆ Passkey ç™»å½•

### ç”¨æˆ·ç®¡ç†
- `GET /user/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

### é’±åŒ…ç®¡ç†
- `GET /wallet/info` - è·å–é’±åŒ…ä¿¡æ¯
- `GET /wallet/balance` - æŸ¥è¯¢é’±åŒ…ä½™é¢
- `GET /wallet/address` - è·å–é’±åŒ…åœ°å€
- `POST /wallet/export-private-key` - å¯¼å‡ºç§é’¥ï¼ˆéœ€é‚®ç®±éªŒè¯ï¼‰

## æ•°æ®å­˜å‚¨

å½“å‰ä½¿ç”¨ JSON æ–‡ä»¶å­˜å‚¨ï¼Œæ•°æ®ä¿å­˜åœ¨ `data/` ç›®å½•ï¼š

```
data/
â”œâ”€â”€ users/           # ç”¨æˆ·æ•°æ®
â”œâ”€â”€ wallets/         # é’±åŒ…æ•°æ®
â”œâ”€â”€ sessions/        # ä¼šè¯æ•°æ®
â”œâ”€â”€ challenges/      # Passkey æŒ‘æˆ˜æ•°æ®
â””â”€â”€ verifications/   # é‚®ç®±éªŒè¯æ•°æ®
```

## å¼€å‘è¯´æ˜

### é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ modules/         # ä¸šåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ auth/       # è®¤è¯æ¨¡å—
â”‚   â”œâ”€â”€ user/       # ç”¨æˆ·ç®¡ç†
â”‚   â”œâ”€â”€ wallet/     # é’±åŒ…ç®¡ç†
â”‚   â””â”€â”€ storage/    # æ•°æ®å­˜å‚¨
â”œâ”€â”€ common/         # é€šç”¨ç»„ä»¶
â”œâ”€â”€ config/         # é…ç½®æ–‡ä»¶
â”œâ”€â”€ interfaces/     # ç±»å‹å®šä¹‰
â””â”€â”€ utils/          # å·¥å…·å‡½æ•°
```

### å¼€å‘å‘½ä»¤

- `npm run start:dev` - å¼€å‘æ¨¡å¼å¯åŠ¨
- `npm run build` - æ„å»ºé¡¹ç›®
- `npm run test` - è¿è¡Œæµ‹è¯•
- `npm run lint` - ä»£ç æ£€æŸ¥

## ç¯å¢ƒé…ç½®

è¯¦ç»†çš„ç¯å¢ƒå˜é‡è¯´æ˜è¯·å‚è€ƒ `.env.example` æ–‡ä»¶ã€‚

## æ³¨æ„äº‹é¡¹

1. **å¼€å‘ç¯å¢ƒ**: é‚®ç®±éªŒè¯ç ä¼šè¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œæ— éœ€é…ç½®çœŸå® SMTP
2. **ç”Ÿäº§ç¯å¢ƒ**: éœ€è¦é…ç½®çœŸå®çš„ SMTP æœåŠ¡å’Œå®‰å…¨çš„ JWT å¯†é’¥
3. **Passkey æ”¯æŒ**: éœ€è¦ HTTPS ç¯å¢ƒï¼ˆæœ¬åœ°å¼€å‘å¯ä½¿ç”¨ localhostï¼‰

## åç»­è®¡åˆ’

- [ ] MongoDB æ•°æ®åº“é›†æˆ
- [ ] ERC-4337 UserOperation æ”¯æŒ
- [ ] BLS ç­¾åèšåˆé›†æˆ
- [ ] é‚®ä»¶è½¬è´¦åŠŸèƒ½
- [ ] å®‰å…¨æ€§å¢å¼º