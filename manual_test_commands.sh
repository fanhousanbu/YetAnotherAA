#!/bin/bash

echo "=== 手动BLS验证测试命令 ==="
echo ""

echo "Step 1: 测试Go Signer (在你的终端执行)"
echo "cd /Users/chao/Codes/YetAnotherAA/signer"
echo "go run main.go -message \"verification test\" -m 3 -n 2"
echo ""

echo "Step 2: 记录输出的关键数据"
echo "- 预编译合约 0xf 的 calldata: [记录完整hex数据]"
echo "- aggregatedPubKey: [记录hex数据]"
echo "- aggregatedSignature: [记录hex数据]"
echo "- messageG2: [记录hex数据]"
echo ""

echo "Step 3: 部署简化合约 (在你的终端执行)"
echo "cd /Users/chao/Codes/YetAnotherAA/validator"
echo 'forge create src/SimpleBLSVerifier.sol:SimpleBLSVerifier --rpc-url https://sepolia.infura.io/v3/7051eb377c77490881070faaf93aef20' --private-key 0x72966a3f12beed253d475a19f4c8c73e5f7c14f2280bcda4499f72602b4d6c1a --broadcast
echo ""

echo "Step 4: 直接测试配对预编译 (用Step 1的calldata替换)"
echo 'cast call --rpc-url "https://sepolia.infura.io/v3/7051eb377c77490881070faaf93aef20" 0x000000000000000000000000000000000000000f "[PASTE_STEP1_CALLDATA]"'
echo ""

echo "Step 5: 测试简化合约 (用新合约地址和Step 1的calldata)"
echo 'cast call --rpc-url "https://sepolia.infura.io/v3/7051eb377c77490881070faaf93aef20" [NEW_CONTRACT_ADDRESS] "verify(bytes)" "[PASTE_STEP1_CALLDATA]"'
echo ""

echo "=== 预期结果分析 ==="
echo "如果Step 4返回 0x0000000000000000000000000000000000000000000000000000000000000001 → 配对验证成功"
echo "如果Step 4返回 0x0000000000000000000000000000000000000000000000000000000000000000 → 配对验证失败"  
echo "如果Step 4调用失败 → 数据格式问题"
echo ""
echo "如果Step 5返回 true → 简化合约工作正常"
echo "如果Step 5返回 false → 合约逻辑问题"

# 提供一些测试用的已知数据
echo ""
echo "=== 测试用已知数据 (如果Step 1失败可用) ==="
echo "# 这是一个768字节的示例配对数据："
echo "EXAMPLE_CALLDATA=\"0x0000000000000000000000000000000017f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb0000000000000000000000000000000008b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000106c1fd7fc5ffba7f10c1e83b28dfeb6ed45033c556e9f9c63fb5ebf11da191b1b46552df3c2f4426be6d57f810490a5000000000000000000000000000000000c1a078ea28a1c39811b4628821c08ea65dd05170f7127e128059476b2813c8367550d667225f39b1c4467e2d7e9e418000000000000000000000000000000000a48476fa1f157a202343f6aa9f947f2d8e1e45496ce18a879545b80b9e4101d7aaba0d8198771059e0e35740707da06000000000000000000000000000000000db0a22638e1a24b8371cdffd3256e37b27a7cfff543f0106ce61eb99297c144eb047cad9209758569ee8762c386e609\""
echo ""
echo "测试命令："
echo 'cast call --rpc-url "https://sepolia.infura.io/v3/7051eb377c77490881070faaf93aef20" 0x0f $EXAMPLE_CALLDATA'